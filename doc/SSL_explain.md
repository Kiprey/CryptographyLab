# SSL 通信

## 一、证书配置

配置三份私钥和证书，分别是

- 客户端的私钥和证书
- 服务端的私钥和证书
- CA 的私钥和证书

并使用 CA 的私钥，分别对 客户端、服务端以及 CA 自己的公钥证书进行签名。

## 二、连接

在进行 SSL 通信之前，客户端和服务端必须配置好

- 自己的私钥路径
- 自己的公钥证书路径
- 可信任的 CA 公钥证书路径。CA 公钥证书用于验证对方是否是可信赖的

配置好后，双方先进行 socket 连接，连接之中不涉及 SSL。

连接完成后，使用 socket 的文件描述符初始化 SSL 对象，并调用 SSL 对象中的 connect 和 accept 方法。这两个方法会尝试进行 SSL 握手，验证对方的证书和等待被对方验证。如果验证失败则立即提醒并断开连接。

如果身份验证成功，则使用 SSL_read 和  SSL_write 函数进行通信。这两个函数底层会数据进行加密并在接收信息时自动完成一系列验证等。

